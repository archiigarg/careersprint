<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login</title>
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
      import {
        getAuth,
        signInWithPopup,
        GoogleAuthProvider,
      } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

      const firebaseConfig = {
        apiKey: "AIzaSyC1d1GjpL-dgC-TenU7Bt9iWqmZUB5AqPM",
        authDomain: "signsync-a13bd.firebaseapp.com",
        projectId: "signsync-a13bd",
        storageBucket: "signsync-a13bd.firebasestorage.app",
        messagingSenderId: "197353783576",
        appId: "1:197353783576:web:afec42965efcb524af5e6d",
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const provider = new GoogleAuthProvider();

      async function loginWithGoogle() {
        try {
          const result = await signInWithPopup(auth, provider);
          const user = result.user;
          const idToken = await user.getIdToken();

          // Send token to backend
          const loginResponse = await fetch(
            "http://localhost:5500/user/login",
            {
              method: "POST",
              headers: {
                Authorization: `Bearer ${idToken}`,
                "Content-Type": "application/json",
              },
            }
          );

          const loginData = await loginResponse.json();
          if (!loginResponse.ok) throw new Error(loginData.message);

          localStorage.setItem("idToken", idToken);
          localStorage.setItem("refreshTime", Date.now() + 55 * 60 * 1000); // Refresh token 5 mins before expiry

          window.location.href = "user.html"; // Redirect to user page
        } catch (error) {
          console.error("Login Error:", error);
          document.getElementById("response").innerText =
            "Error: " + error.message;
        }
      }

      window.loginWithGoogle = loginWithGoogle;
    </script>
  </head>
  <body>
    <h1>Login Page</h1>
    <button onclick="loginWithGoogle()">Login with Google</button>
    <p id="response"></p>
  </body>
</html>


